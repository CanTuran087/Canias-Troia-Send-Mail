OBJECT: 
 STRING FILEPATH,
 INTEGER COUNT,
 INTEGER COUNT2,
 INTEGER COUNT3,
 INTEGER COUNT4,
 STRING STRSEL,
 STRING USERTMPFOLDER,
 STRING TARGET,
 TABLE TMPFOLDERLIST,
 STRING SDOCDATE;

COUNT = 6;
COUNT2 = 1;
COUNT3 = 3;
COUNT4 = 0;
SDOCDATE = ZPOSTDATEFROM + ' - ' + ZPOSTDATETO;

FILEPATH = ''; //İLGİLİ RESOURCES DOSYA YOLU
USERTMPFOLDER='*'+REPLACE(GETUSERINFO('client.temp.folder'),'\','/');
TARGET = USERTMPFOLDER + 'FINT02 YEVMİYE DÖKÜMÜ.xlsx';
FILELIST USERTMPFOLDER TO TMPFOLDERLIST;

STRSEL = ' F1.ACCOUNT AS HESAPNO, F1.GLACCOUNT AS TDHESAPNO, F1.ATEXT AS HESAPADI, F1.CURRENCY AS PARABIRIMI, CAST(CONVERT(DATE,F1.DOCDATE) AS VARCHAR(MAX)) AS BELGETARIH, ';
STRSEL = STRSEL + ' CAST(FORMAT((CASE WHEN F1.POSTWAY = 0 THEN F1.HPOSTAMNT ELSE 0 END),'+TOCHAR(39)+'c'+TOCHAR(39)+','+TOCHAR(39)+'TR-tr'+TOCHAR(39)+') ';
STRSEL = STRSEL + ' AS VARCHAR(MAX)) AS BORC, CAST(FORMAT((CASE WHEN F1.POSTWAY = 1 THEN F1.DPOSTAMNT ELSE 0 END), ';
STRSEL = STRSEL + TOCHAR(39)+'c'+TOCHAR(39)+','+TOCHAR(39)+'TR-tr'+TOCHAR(39)+') AS VARCHAR(MAX)) AS ALACAK ';

ACCESSXLS FILEPATH WRITE SHEET 1 'B' COUNT2 VALUE '';
ACCESSXLS FILEPATH WRITE SHEET 1 'B' COUNT3 VALUE '';

SELECT STEXT,LOGOFILE 
	FROM IASBAS001 
	WHERE CLIENT = SYS_CLIENT 
		AND COMPANY = ZCOMPANY 
	INTO TMPCOMPANY;


IF SELECTED THEN
	ACCESSXLS FILEPATH WRITE SHEET 1 'B' COUNT2 VALUE TMPCOMPANY_STEXT;
	ACCESSXLS FILEPATH WRITE SHEET 1 'J' COUNT2 ADDIMAGE TMPCOMPANY_LOGOFILE RESIZE IMAGE;
ENDIF;

ACCESSXLS FILEPATH WRITE SHEET 1 'B' COUNT3 VALUE SDOCDATE;

IF FINHEADLIST_ROWCOUNT <= 0 THEN
	RETURN;
ENDIF;


WHILE COUNT <= 15000 
BEGIN
	ACCESSXLS FILEPATH WRITE SHEET 1 'A' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'B' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'C' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'D' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'E' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'F' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'G' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'H' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'I' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	ACCESSXLS FILEPATH WRITE SHEET 1 'J' COUNT VALUE '' BORDER NONE FORECOLOR BLACK;
	COUNT = COUNT + 1;
ENDWHILE;

COUNT = 6;

LOOP AT FINHEADLIST 
BEGIN
	SELECT HESAPNO, TDHESAPNO, HESAPADI, BELGETARIH,
		 LTRIM(RTRIM(LEFT(BORC, LEN(BORC)-1))) AS BORC, LTRIM(RTRIM(LEFT(ALACAK,LEN(ALACAK)-1))) AS ALACAK,
		 PARABIRIMI 
		FROM (SELECT @STRSEL FROM IASFINITEM F1 
		INNER JOIN IASFINHEAD F2 ON F2.CLIENT = F1.CLIENT 
			AND F2.COMPANY = F1.COMPANY 
			AND F2.FINDOCTYPE = F1.FINDOCTYPE 
			AND F2.FINDOCNUM = F1.FINDOCNUM 
			AND F2.ISCANCEL = 0 
		WHERE F1.CLIENT = SYS_CLIENT 
			AND F1.COMPANY = ZCOMPANY 
			AND F1.FINDOCTYPE = FINHEADLIST_FINDOCTYPE2 
			AND F1.FINDOCNUM = FINHEADLIST_FINDOCNUM2 
			AND F1.ISCANCEL = 0) UPPERQUERY 
		INTO TMPFINHEADLIST;


	IF SELECTED THEN

		LOOP AT TMPFINHEADLIST 
		BEGIN
			ACCESSXLS FILEPATH WRITE SHEET 1 'A' COUNT VALUE FINHEADLIST_FINDOCTYPE2 BORDER THIN;
			ACCESSXLS FILEPATH WRITE SHEET 1 'B' COUNT VALUE FINHEADLIST_FINDOCNUM2 BORDER THIN FONT NORMAL;
			ACCESSXLS FILEPATH WRITE SHEET 1 'C' COUNT VALUE TMPFINHEADLIST_BELGETARIH BORDER THIN;
			ACCESSXLS FILEPATH WRITE SHEET 1 'D' COUNT VALUE TMPFINHEADLIST_HESAPNO BORDER THIN;
			ACCESSXLS FILEPATH WRITE SHEET 1 'E' COUNT VALUE TMPFINHEADLIST_TDHESAPNO BORDER THIN;
			ACCESSXLS FILEPATH WRITE SHEET 1 'F' COUNT VALUE TMPFINHEADLIST_HESAPADI BORDER THIN;
			ACCESSXLS FILEPATH WRITE SHEET 1 'G' COUNT VALUE FINHEADLIST_STEXT BORDER THIN;
			ACCESSXLS FILEPATH WRITE SHEET 1 'H' COUNT VALUE TMPFINHEADLIST_BORC BORDER THIN;
			ACCESSXLS FILEPATH WRITE SHEET 1 'I' COUNT VALUE TMPFINHEADLIST_ALACAK BORDER THIN;
			ACCESSXLS FILEPATH WRITE SHEET 1 'J' COUNT VALUE TMPFINHEADLIST_PARABIRIMI BORDER THIN;

			IF COUNT4 % 2 == 0 THEN
				ACCESSXLS FILEPATH WRITE SHEET 1 'B' COUNT FORECOLOR PINK FONT BOLD;
			ELSE
				ACCESSXLS FILEPATH WRITE SHEET 1 'B' COUNT FORECOLOR BLACK;
			ENDIF;


			IF TMPFINHEADLIST_BORC != '0,00' THEN
				ACCESSXLS FILEPATH WRITE SHEET 1 'H' COUNT FORECOLOR GREEN;
			ELSE
			    ACCESSXLS FILEPATH WRITE SHEET 1 'H' COUNT FORECOLOR BLACK;
			ENDIF;


			IF TMPFINHEADLIST_ALACAK != '0,00' THEN
				ACCESSXLS FILEPATH WRITE SHEET 1 'I' COUNT FORECOLOR GREEN;
		    ELSE
                ACCESSXLS FILEPATH WRITE SHEET 1 'I' COUNT FORECOLOR BLACK;
			ENDIF;

			COUNT = COUNT + 1;
		ENDLOOP;

	ENDIF;

	COUNT4 = COUNT4 + 1;
ENDLOOP;


LOOP AT TMPFOLDERLIST 
BEGIN

	IF STRPOS(TMPFOLDERLIST_NAME, 'FINT02 YEVMİYE DÖKÜMÜ.xlsx') > 0 THEN
		USERTMPFOLDER = USERTMPFOLDER + TMPFOLDERLIST_NAME;
		DELETEFILE USERTMPFOLDER;
	ENDIF;

ENDLOOP;

FILEEXISTS TARGET;

IF !SYS_STATUS THEN
	RUNFILE TARGET;
ELSE
	COPYFILE FILEPATH INTO TARGET;
	RUNFILE TARGET;
ENDIF;